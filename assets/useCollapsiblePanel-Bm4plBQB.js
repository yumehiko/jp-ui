import{r as s}from"./iframe-DXOI1E9u.js";import{u as k}from"./useControlled-DEAayXAn.js";import{b as N,f as K,a as z}from"./mergeClassName-4BJ6eZC9.js";import{u as B}from"./useStableCallback-BG29bmz1.js";import{u as V}from"./useBaseUiId-DPGNyegz.js";import{c as U,t as G,n as J}from"./createBaseUIEventDetails-DuvT8Jvz.js";import{a as Q,T as W}from"./useOpenChangeComplete-EYYQQ2xa.js";import{u as X}from"./useTransitionStatus-BSiOYNFN.js";import{u as Y}from"./useOnMount-i2UvWo5T.js";import{u as Z,A as m}from"./useAnimationFrame-CLJ86gM1.js";function he(t){const{open:r,defaultOpen:o,onOpenChange:j,disabled:H}=t,y=r!==void 0,[p,R]=k({controlled:r,default:o,name:"Collapsible",state:"open"}),{mounted:g,setMounted:h,transitionStatus:l}=X(p,!0,!0),[a,b]=s.useState(p),[{height:d,width:v},P]=s.useState({height:void 0,width:void 0}),w=V(),[F,x]=s.useState(),L=F??w,[C,A]=s.useState(!1),[E,M]=s.useState(!1),I=s.useRef(null),c=s.useRef(null),D=s.useRef(null),S=s.useRef(null),e=Q(S,!1),u=B(i=>{const n=!p,f=U(G,i.nativeEvent);if(j(n,f),f.isCanceled)return;const O=S.current;c.current==="css-animation"&&O!=null&&O.style.removeProperty("animation-name"),!C&&!E&&(c.current!=null&&c.current!=="css-animation"&&!g&&n&&h(!0),c.current==="css-animation"&&(!a&&n&&b(!0),!g&&n&&h(!0))),R(n),c.current==="none"&&g&&!n&&h(!1)});return N(()=>{y&&c.current==="none"&&!E&&!p&&h(!1)},[y,E,p,r,h]),s.useMemo(()=>({abortControllerRef:I,animationTypeRef:c,disabled:H,handleTrigger:u,height:d,mounted:g,open:p,panelId:L,panelRef:S,runOnceAnimationsFinish:e,setDimensions:P,setHiddenUntilFound:A,setKeepMounted:M,setMounted:h,setOpen:R,setPanelIdState:x,setVisible:b,transitionDimensionRef:D,transitionStatus:l,visible:a,width:v}),[I,c,H,u,d,g,p,L,S,e,P,A,M,h,R,b,D,l,a,v])}const $=s.createContext(void 0);function ge(){const t=s.useContext($);if(t===void 0)throw new Error(K(15));return t}let T=(function(t){return t.open="data-open",t.closed="data-closed",t[t.startingStyle=W.startingStyle]="startingStyle",t[t.endingStyle=W.endingStyle]="endingStyle",t})({}),ee=(function(t){return t.panelOpen="data-panel-open",t})({});const te={[T.open]:""},ne={[T.closed]:""},ye={open(t){return t?{[ee.panelOpen]:""}:null}},be={open(t){return t?te:ne}};let re=(function(t){return t.disabled="data-disabled",t.orientation="data-orientation",t})({});function ve(t){const{abortControllerRef:r,animationTypeRef:o,externalRef:j,height:H,hiddenUntilFound:y,keepMounted:p,id:R,mounted:g,onOpenChange:h,open:l,panelRef:a,runOnceAnimationsFinish:b,setDimensions:d,setMounted:v,setOpen:P,setVisible:w,transitionDimensionRef:F,visible:x,width:L}=t,C=s.useRef(!1),A=s.useRef(null),E=s.useRef(l),M=s.useRef(l),I=Z(),c=s.useMemo(()=>o.current==="css-animation"?!x:!l&&!g,[l,g,x,o]),D=B(e=>{if(!e)return;if(o.current==null||F.current==null){const n=getComputedStyle(e),f=n.animationName!=="none"&&n.animationName!=="",O=n.transitionDuration!=="0s"&&n.transitionDuration!=="";f&&O||(n.animationName==="none"&&n.transitionDuration!=="0s"?o.current="css-transition":n.animationName!=="none"&&n.transitionDuration==="0s"?o.current="css-animation":o.current="none"),e.getAttribute(re.orientation)==="horizontal"||n.transitionProperty.indexOf("width")>-1?F.current="width":F.current="height"}if(o.current!=="css-transition")return;(H===void 0||L===void 0)&&(d({height:e.scrollHeight,width:e.scrollWidth}),M.current&&e.style.setProperty("transition-duration","0s"));let u=-1,i=-1;return u=m.request(()=>{M.current=!1,i=m.request(()=>{setTimeout(()=>{e.style.removeProperty("transition-duration")})})}),()=>{m.cancel(u),m.cancel(i)}}),S=z(j,a,D);return N(()=>{if(o.current!=="css-transition")return;const e=a.current;if(!e)return;let u=-1;if(r.current!=null&&(r.current.abort(),r.current=null),l){const i={"justify-content":e.style.justifyContent,"align-items":e.style.alignItems,"align-content":e.style.alignContent,"justify-items":e.style.justifyItems};Object.keys(i).forEach(n=>{e.style.setProperty(n,"initial","important")}),!M.current&&!p&&e.setAttribute(T.startingStyle,""),d({height:e.scrollHeight,width:e.scrollWidth}),u=m.request(()=>{Object.entries(i).forEach(([n,f])=>{f===""?e.style.removeProperty(n):e.style.setProperty(n,f)})})}else{if(e.scrollHeight===0&&e.scrollWidth===0)return;d({height:e.scrollHeight,width:e.scrollWidth});const i=new AbortController;r.current=i;const n=i.signal;let f=null;const O=T.endingStyle;return f=new MutationObserver(_=>{_.some(q=>q.type==="attributes"&&q.attributeName===O)&&(f?.disconnect(),f=null,b(()=>{d({height:0,width:0}),e.style.removeProperty("content-visibility"),v(!1),r.current===i&&(r.current=null)},n))}),f.observe(e,{attributes:!0,attributeFilter:[O]}),()=>{f?.disconnect(),I.cancel(),r.current===i&&(i.abort(),r.current=null)}}return()=>{m.cancel(u)}},[r,o,I,y,p,g,l,a,b,d,v]),N(()=>{if(o.current!=="css-animation")return;const e=a.current;e&&(A.current=e.style.animationName||A.current,e.style.setProperty("animation-name","none"),d({height:e.scrollHeight,width:e.scrollWidth}),!E.current&&!C.current&&e.style.removeProperty("animation-name"),l?(r.current!=null&&(r.current.abort(),r.current=null),v(!0),w(!0)):(r.current=new AbortController,b(()=>{v(!1),w(!1),r.current=null},r.current.signal)))},[r,o,l,a,b,d,v,w,x]),Y(()=>{const e=m.request(()=>{E.current=!1});return()=>m.cancel(e)}),N(()=>{if(!y)return;const e=a.current;if(!e)return;let u=-1,i=-1;return l&&C.current&&(e.style.transitionDuration="0s",d({height:e.scrollHeight,width:e.scrollWidth}),u=m.request(()=>{C.current=!1,i=m.request(()=>{setTimeout(()=>{e.style.removeProperty("transition-duration")})})})),()=>{m.cancel(u),m.cancel(i)}},[y,l,a,d]),N(()=>{const e=a.current;e&&y&&c&&(e.setAttribute("hidden","until-found"),o.current==="css-transition"&&e.setAttribute(T.startingStyle,""))},[y,c,o,a]),s.useEffect(function(){const u=a.current;if(!u)return;function i(n){C.current=!0,P(!0),h(!0,U(J,n))}return u.addEventListener("beforematch",i),()=>{u.removeEventListener("beforematch",i)}},[h,a,P]),s.useMemo(()=>({props:{hidden:c,id:R,ref:S}}),[c,R,S])}export{$ as C,ge as a,ve as b,be as c,ye as t,he as u};
