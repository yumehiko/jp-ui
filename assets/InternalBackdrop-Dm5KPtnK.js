import{b as ce,c as ze,d as Ke,i as U,e as rt}from"./floating-ui.utils.dom-CWuwp5es.js";import{b as ot,c as st}from"./detectBrowser-CYw91I8L.js";import{o as le}from"./owner-CvMgaIeV.js";import{b as J,N as it,a as Ie}from"./mergeClassName-CGuaxy8D.js";import{T as Oe,u as Ae}from"./useTimeout-D67vsree.js";import{A as ct,u as lt}from"./useAnimationFrame-DjvyS4jC.js";import{r as h}from"./iframe-DCTwtVEg.js";import{f as ut,y as at,z as Ue,A as he,B as Me,n as Pe,k as Ne,m as ft,r as dt,v as _e,b as bt,E as pt}from"./popupStateMapping-D9WKduT9.js";import{u as ne}from"./useValueAsRef-BBKeM-2h.js";import{u as Q}from"./useStableCallback-BlvU505D.js";import{v as mt}from"./visuallyHidden-CbwUG2x5.js";import{m as ht,q as gt,c as vt,o as yt}from"./createBaseUIEventDetails-BDhVKG5E.js";import{d as D,i as De,b as We,a as _,c as x,g as re}from"./element-C8qsRkBu.js";import{r as $}from"./useOpenChangeComplete-CAiTarFg.js";import{j as ie}from"./jsx-runtime-u17CrQMm.js";import{b as Be,g as Ge}from"./useInteractions-DGgngZ7b.js";import{i as Et,a as kt,s as wt}from"./event-CNRsvx7q.js";let Ve={},qe={},Ye="";function Rt(e){if(typeof document>"u")return!1;const r=le(e);return ce(r).innerWidth-r.documentElement.clientWidth>0}function Tt(e){const r=le(e),t=r.documentElement,n=r.body,o=ze(t)?t:n,c=o.style.overflow;return o.style.overflow="hidden",()=>{o.style.overflow=c}}function xt(e){const r=le(e),t=r.documentElement,n=r.body,o=ce(t);let c=0,d=0;const T=ct.create(),E=typeof CSS<"u"&&CSS.supports?.("scrollbar-gutter","stable");if(st&&(o.visualViewport?.scale??1)!==1)return()=>{};function C(){const L=o.getComputedStyle(t),u=o.getComputedStyle(n),w=(L.scrollbarGutter||"").includes("both-edges")?"stable both-edges":"stable";c=t.scrollTop,d=t.scrollLeft,Ve={scrollbarGutter:t.style.scrollbarGutter,overflowY:t.style.overflowY,overflowX:t.style.overflowX},Ye=t.style.scrollBehavior,qe={position:n.style.position,height:n.style.height,width:n.style.width,boxSizing:n.style.boxSizing,overflowY:n.style.overflowY,overflowX:n.style.overflowX,scrollBehavior:n.style.scrollBehavior};const R=t.scrollHeight>t.clientHeight,b=t.scrollWidth>t.clientWidth,p=L.overflowY==="scroll"||u.overflowY==="scroll",j=L.overflowX==="scroll"||u.overflowX==="scroll",I=Math.max(0,o.innerWidth-t.clientWidth),N=Math.max(0,o.innerHeight-t.clientHeight),X=parseFloat(u.marginTop)+parseFloat(u.marginBottom),z=parseFloat(u.marginLeft)+parseFloat(u.marginRight),S=ze(t)?t:n;if(E){t.style.scrollbarGutter=w,S.style.overflowY="hidden",S.style.overflowX="hidden";return}Object.assign(t.style,{scrollbarGutter:w,overflowY:"hidden",overflowX:"hidden"}),(R||p)&&(t.style.overflowY="scroll"),(b||j)&&(t.style.overflowX="scroll"),Object.assign(n.style,{position:"relative",height:X||N?`calc(100dvh - ${X+N}px)`:"100dvh",width:z||I?`calc(100vw - ${z+I}px)`:"100vw",boxSizing:"border-box",overflow:"hidden",scrollBehavior:"unset"}),n.scrollTop=c,n.scrollLeft=d,t.setAttribute("data-base-ui-scroll-locked",""),t.style.scrollBehavior="unset"}function P(){Object.assign(t.style,Ve),Object.assign(n.style,qe),E||(t.scrollTop=c,t.scrollLeft=d,t.removeAttribute("data-base-ui-scroll-locked"),t.style.scrollBehavior=Ye)}function B(){P(),T.request(C)}return C(),o.addEventListener("resize",B),()=>{T.cancel(),P(),typeof o.removeEventListener=="function"&&o.removeEventListener("resize",B)}}class St{lockCount=0;restore=null;timeoutLock=Oe.create();timeoutUnlock=Oe.create();acquire(r){return this.lockCount+=1,this.lockCount===1&&this.restore===null&&this.timeoutLock.start(0,()=>this.lock(r)),this.release}release=()=>{this.lockCount-=1,this.lockCount===0&&this.restore&&this.timeoutUnlock.start(0,this.unlock)};unlock=()=>{this.lockCount===0&&this.restore&&(this.restore?.(),this.restore=null)};lock(r){if(this.lockCount===0||this.restore!==null)return;const n=le(r).documentElement,o=ce(n).getComputedStyle(n).overflowY;if(o==="hidden"||o==="clip"){this.restore=it;return}const c=ot||!Rt(r);this.restore=c?Tt(r):xt(r)}}const Ct=new St;function Zt(e=!0,r=null){J(()=>{if(e)return Ct.acquire(r)},[e,r])}let $e=0;function be(e,r={}){const{preventScroll:t=!1,cancelPrevious:n=!0,sync:o=!1}=r;n&&cancelAnimationFrame($e);const c=()=>e?.focus({preventScroll:t});o?c():$e=requestAnimationFrame(c)}const H={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function He(e){return e==="inert"?H.inert:e==="aria-hidden"?H["aria-hidden"]:H.none}let oe=new WeakSet,se={},pe=0;const Je=e=>e&&(e.host||Je(e.parentNode)),Ft=(e,r)=>r.map(t=>{if(e.contains(t))return t;const n=Je(t);return e.contains(n)?n:null}).filter(t=>t!=null);function Lt(e,r,t,n){const o="data-base-ui-inert",c=n?"inert":t?"aria-hidden":null,d=Ft(r,e),T=new Set,E=new Set(d),C=[];se[o]||(se[o]=new WeakMap);const P=se[o];d.forEach(B),L(r),T.clear();function B(u){!u||T.has(u)||(T.add(u),u.parentNode&&B(u.parentNode))}function L(u){!u||E.has(u)||[].forEach.call(u.children,k=>{if(Ke(k)!=="script")if(T.has(k))L(k);else{const q=c?k.getAttribute(c):null,w=q!==null&&q!=="false",R=He(c),b=(R.get(k)||0)+1,p=(P.get(k)||0)+1;R.set(k,b),P.set(k,p),C.push(k),b===1&&w&&oe.add(k),p===1&&k.setAttribute(o,""),!w&&c&&k.setAttribute(c,c==="inert"?"":"true")}})}return pe+=1,()=>{C.forEach(u=>{const k=He(c),w=(k.get(u)||0)-1,R=(P.get(u)||0)-1;k.set(u,w),P.set(u,R),w||(!oe.has(u)&&c&&u.removeAttribute(c),oe.delete(u)),R||u.removeAttribute(o)}),pe-=1,pe||(H.inert=new WeakMap,H["aria-hidden"]=new WeakMap,H.none=new WeakMap,oe=new WeakSet,se={})}}function It(e,r=!1,t=!1){const n=D(e[0]).body;return Lt(e.concat(Array.from(n.querySelectorAll("[aria-live]"))),n,r,t)}function Ot(e,r){const t=ce(e.target);return e instanceof t.KeyboardEvent?"keyboard":e instanceof t.FocusEvent?r||"keyboard":"pointerType"in e?e.pointerType||"keyboard":"touches"in e?"touch":e instanceof t.MouseEvent?r||(e.detail===0?"keyboard":"mouse"):""}const je=20;let W=[];function ge(){W=W.filter(e=>e.isConnected)}function At(e){ge(),e&&Ke(e)!=="body"&&(W.push(e),W.length>je&&(W=W.slice(-je)))}function me(){return ge(),W[W.length-1]}function Mt(e){if(!e)return null;const r=he();return _e(e,r)?e:Ue(e,r)[0]||e}function Pt(e){return!e||!e.isConnected?!1:typeof e.checkVisibility=="function"?e.checkVisibility():rt(e).display!=="none"}function Xe(e,r){if(!r.current.includes("floating")&&!e.getAttribute("role")?.includes("dialog"))return;const t=he(),o=pt(e,t).filter(d=>{const T=d.getAttribute("data-tabindex")||"";return _e(d,t)||d.hasAttribute("data-tabindex")&&!T.startsWith("-")}),c=e.getAttribute("tabindex");r.current.includes("floating")||o.length===0?c!=="0"&&e.setAttribute("tabindex","0"):(c!=="-1"||e.hasAttribute("data-tabindex")&&e.getAttribute("data-tabindex")!=="-1")&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}function en(e){const{context:r,children:t,disabled:n=!1,order:o=["content"],initialFocus:c=!0,returnFocus:d=!0,restoreFocus:T=!1,modal:E=!0,closeOnFocusOut:C=!0,openInteractionType:P="",getInsideElements:B=()=>[],nextFocusableElement:L,previousFocusableElement:u,beforeContentFocusGuardRef:k,externalTree:q}=e,w="rootStore"in r?r.rootStore:r,R=w.useState("open"),b=w.useState("domReferenceElement"),p=w.useState("floatingElement"),{events:j,dataRef:I}=w.context,N=Q(()=>I.current.floatingContext?.nodeId),X=Q(B),z=c===!1,S=De(b)&&z,G=ne(o),ve=ne(c),Z=ne(d),ye=ne(P),O=ut(q),g=at(),Qe=h.useRef(null),Ze=h.useRef(null),A=h.useRef(!1),ee=h.useRef(!1),ue=h.useRef(!1),Ee=h.useRef(-1),ke=h.useRef(""),ae=h.useRef(""),we=Ae(),Re=Ae(),Te=lt(),fe=g!=null,l=We(p),V=Q((i=l)=>i?Ue(i,he()):[]),K=Q(i=>{const a=V(i);return G.current.map(()=>a).filter(Boolean).flat()});h.useEffect(()=>{if(n||!E)return;function i(v){v.key==="Tab"&&x(l,_(D(l)))&&V().length===0&&!S&&wt(v)}const a=D(l);return a.addEventListener("keydown",i),()=>{a.removeEventListener("keydown",i)}},[n,b,l,E,G,S,V,K]),h.useEffect(()=>{if(n||!p)return;function i(a){const v=re(a),y=V().indexOf(v);y!==-1&&(Ee.current=y)}return p.addEventListener("focusin",i),()=>{p.removeEventListener("focusin",i)}},[n,p,V]),h.useEffect(()=>{if(n||!R)return;const i=D(l);function a(){ue.current=!1}function v(y){const s=re(y),f=x(p,s)||x(b,s)||x(g?.portalNode,s);ue.current=!f,ae.current=y.pointerType||"keyboard"}function m(){ae.current="keyboard"}return i.addEventListener("pointerdown",v,!0),i.addEventListener("pointerup",a,!0),i.addEventListener("pointercancel",a,!0),i.addEventListener("keydown",m,!0),()=>{i.removeEventListener("pointerdown",v,!0),i.removeEventListener("pointerup",a,!0),i.removeEventListener("pointercancel",a,!0),i.removeEventListener("keydown",m,!0)}},[n,p,b,l,R,g]),h.useEffect(()=>{if(n||!C)return;function i(){ee.current=!0,Re.start(0,()=>{ee.current=!1})}function a(s){const f=s.relatedTarget,Y=s.currentTarget,F=re(s);queueMicrotask(()=>{const te=N(),Fe=w.context.triggerElements,nt=!(x(b,f)||x(p,f)||x(f,p)||x(g?.portalNode,f)||f!=null&&Fe.hasElement(f)||Fe.hasMatchingElement(M=>x(M,f))||f?.hasAttribute(Me("focus-guard"))||O&&(Ge(O.nodesRef.current,te).find(M=>x(M.context?.elements.floating,f)||x(M.context?.elements.domReference,f))||Be(O.nodesRef.current,te).find(M=>[M.context?.elements.floating,We(M.context?.elements.floating)].includes(f)||M.context?.elements.domReference===f)));if(Y===b&&l&&Xe(l,G),T&&Y!==b&&!Pt(F)&&_(D(l))===D(l).body){if(U(l)&&(l.focus(),T==="popup")){Te.request(()=>{l.focus()});return}const M=Ee.current,de=V(),Le=de[M]||de[de.length-1]||l;U(Le)&&Le.focus()}if(I.current.insideReactTree){I.current.insideReactTree=!1;return}(S||!E)&&f&&nt&&!ee.current&&(S||f!==me())&&(A.current=!0,w.setOpen(!1,vt(yt,s)))})}function v(){ue.current||(I.current.insideReactTree=!0,we.start(0,()=>{I.current.insideReactTree=!1}))}const m=U(b)?b:null,y=[];if(!(!p&&!m))return m&&(m.addEventListener("focusout",a),m.addEventListener("pointerdown",i),y.push(()=>{m.removeEventListener("focusout",a),m.removeEventListener("pointerdown",i)})),p&&(p.addEventListener("focusout",a),g&&(p.addEventListener("focusout",v,!0),y.push(()=>{p.removeEventListener("focusout",v,!0)})),y.push(()=>{p.removeEventListener("focusout",a)})),()=>{y.forEach(s=>{s()})}},[n,b,p,l,E,O,g,w,C,T,V,S,N,G,I,we,Re,Te]);const xe=h.useRef(null),Se=h.useRef(null),et=Ie(xe,k,g?.beforeInsideRef),tt=Ie(Se,g?.afterInsideRef);h.useEffect(()=>{if(n||!p||!R)return;const i=Array.from(g?.portalNode?.querySelectorAll(`[${Me("portal")}]`)||[]),v=(O?Be(O.nodesRef.current,N()):[]).find(s=>De(s.context?.elements.domReference||null))?.context?.elements.domReference,m=[p,v,...i,...X(),Qe.current,Ze.current,xe.current,Se.current,g?.beforeOutsideRef.current,g?.afterOutsideRef.current,$(u),$(L),S?b:null].filter(s=>s!=null),y=It(m,E||S);return()=>{y()}},[R,n,b,p,E,G,g,S,O,N,X,L,u]),J(()=>{if(!R||n||!U(l))return;const i=D(l),a=_(i);queueMicrotask(()=>{const v=K(l),m=ve.current,y=typeof m=="function"?m(ye.current||""):m;if(y===void 0||y===!1)return;let s;y===!0||y===null?s=v[0]||l:s=$(y),s=s||v[0]||l,!x(l,a)&&be(s,{preventScroll:s===l})})},[n,R,l,z,K,ve,ye]),J(()=>{if(n||!l)return;const i=D(l),a=_(i);At(a);function v(s){if(s.open||(ke.current=Ot(s.nativeEvent,ae.current)),s.reason===ht&&s.nativeEvent.type==="mouseleave"&&(A.current=!0),s.reason===gt)if(s.nested)A.current=!1;else if(Et(s.nativeEvent)||kt(s.nativeEvent))A.current=!1;else{let f=!1;document.createElement("div").focus({get preventScroll(){return f=!0,!1}}),f?A.current=!1:A.current=!0}}j.on("openchange",v);const m=i.createElement("span");m.setAttribute("tabindex","-1"),m.setAttribute("aria-hidden","true"),Object.assign(m.style,mt),fe&&b&&b.insertAdjacentElement("afterend",m);function y(){const s=Z.current;let f=typeof s=="function"?s(ke.current):s;if(f===void 0||f===!1)return null;if(f===null&&(f=!0),typeof f=="boolean"){const F=b||me();return F&&F.isConnected?F:m}const Y=b||me()||m;return $(f)||Y}return()=>{j.off("openchange",v);const s=_(i),f=x(p,s)||O&&Ge(O.nodesRef.current,N(),!1).some(F=>x(F.context?.elements.floating,s)),Y=y();queueMicrotask(()=>{const F=Mt(Y),te=typeof Z.current!="boolean";Z.current&&!A.current&&U(F)&&(!(!te&&F!==s&&s!==i.body)||f)&&F.focus({preventScroll:!0}),m.remove()})}},[n,p,l,Z,I,j,O,fe,b,N]),h.useEffect(()=>{queueMicrotask(()=>{A.current=!1})},[n]),h.useEffect(()=>{if(n||!R)return;function i(v){re(v)?.closest(`[${bt}]`)&&(ee.current=!0)}const a=D(l);return a.addEventListener("pointerdown",i,!0),()=>{a.removeEventListener("pointerdown",i,!0)}},[n,R,l]),J(()=>{if(!n&&g)return g.setFocusManagerState({modal:E,closeOnFocusOut:C,open:R,onOpenChange:w.setOpen,domReference:b}),()=>{g.setFocusManagerState(null)}},[n,g,E,R,w,C,b]),J(()=>{if(!(n||!l))return Xe(l,G),()=>{queueMicrotask(ge)}},[n,l,G]);const Ce=!n&&(E?!S:!0)&&(fe||E);return ie.jsxs(h.Fragment,{children:[Ce&&ie.jsx(Pe,{"data-type":"inside",ref:et,onFocus:i=>{if(E){const a=K();be(a[a.length-1])}else g?.portalNode&&(A.current=!1,Ne(i,g.portalNode)?ft(b)?.focus():$(u??g.beforeOutsideRef)?.focus())}}),t,Ce&&ie.jsx(Pe,{"data-type":"inside",ref:tt,onFocus:i=>{E?be(K()[0]):g?.portalNode&&(C&&(A.current=!0),Ne(i,g.portalNode)?dt(b)?.focus():$(L??g.afterOutsideRef)?.focus())}})]})}function Nt(e){const r=h.useRef(""),t=h.useCallback(o=>{o.defaultPrevented||(r.current=o.pointerType,e(o,o.pointerType))},[e]);return{onClick:h.useCallback(o=>{if(o.detail===0){e(o,"keyboard");return}"pointerType"in o&&e(o,o.pointerType),e(o,r.current),r.current=""},[e]),onPointerDown:t}}function tn(e){const[r,t]=h.useState(null),n=Q((T,E)=>{e||t(E)}),o=h.useCallback(()=>{t(null)},[]),{onClick:c,onPointerDown:d}=Nt(n);return h.useMemo(()=>({openMethod:r,reset:o,triggerProps:{onClick:c,onPointerDown:d}}),[r,o,c,d])}const nn=h.forwardRef(function(r,t){const{cutout:n,...o}=r;let c;if(n){const d=n?.getBoundingClientRect();c=`polygon(
      0% 0%,
      100% 0%,
      100% 100%,
      0% 100%,
      0% 0%,
      ${d.left}px ${d.top}px,
      ${d.left}px ${d.bottom}px,
      ${d.right}px ${d.bottom}px,
      ${d.right}px ${d.top}px,
      ${d.left}px ${d.top}px
    )`}return ie.jsx("div",{ref:t,role:"presentation","data-base-ui-inert":"",...o,style:{position:"fixed",inset:0,userSelect:"none",WebkitUserSelect:"none",clipPath:c}})});export{en as F,nn as I,Zt as a,be as e,tn as u};
