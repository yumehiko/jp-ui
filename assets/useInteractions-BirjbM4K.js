import{r as h}from"./iframe-DXOI1E9u.js";import{f as O,a as Q,g as Oe,i as Ie,e as Me,j as Z,k as xe}from"./floating-ui.utils.dom-CWuwp5es.js";import{u as le,T as Ke}from"./useTimeout-JrQkYQHa.js";import{u as f}from"./useStableCallback-BG29bmz1.js";import{f as Ae,B as Ye}from"./popupStateMapping-CpSo4hCe.js";import{c as x,g as _e,q as Xe,t as ue,n as Be}from"./createBaseUIEventDetails-DuvT8Jvz.js";import{d as We}from"./event-CNRsvx7q.js";import{g as I,d as fe,c as B,f as Ne,h as v}from"./element-C8qsRkBu.js";import{F as Fe,d as pe,S as me}from"./constants-CNjsXAL1.js";function N(s,y,n=!0){return s.filter(o=>o.parentId===y&&(!n||o.context?.open)).flatMap(o=>[o,...N(s,o.id,n)])}function et(s,y){let n=[],l=s.find(o=>o.id===y)?.parentId;for(;l;){const o=s.find(a=>a.id===l);l=o?.parentId,o&&(n=n.concat(o))}return n}const He={intentional:"onClick",sloppy:"onPointerDown"};function Ue(s){return{escapeKey:typeof s=="boolean"?s:s?.escapeKey??!1,outsidePress:typeof s=="boolean"?s:s?.outsidePress??!0}}function tt(s,y={}){const n="rootStore"in s?s.rootStore:s,l=n.useState("open"),o=n.useState("floatingElement"),a=n.useState("referenceElement"),u=n.useState("domReferenceElement"),{onOpenChange:T,dataRef:p}=n.context,{enabled:i=!0,escapeKey:K=!0,outsidePress:A=!0,outsidePressEvent:F="sloppy",referencePress:z=!1,referencePressEvent:H="sloppy",ancestorScroll:ee=!1,bubbles:Ee,externalTree:ge}=y,C=Ae(ge),he=f(typeof A=="function"?A:()=>!1),L=typeof A=="function"?he:A,U=h.useRef(!1),{escapeKey:Y,outsidePress:te}=Ue(Ee),g=h.useRef(null),_=le(),ne=le(),S=f(()=>{ne.clear(),p.current.insideReactTree=!1}),V=h.useRef(!1),se=h.useRef(""),q=f(e=>{se.current=e.pointerType}),k=f(()=>{const e=se.current,r=e==="pen"||!e?"mouse":e,t=typeof F=="function"?F():F;return typeof t=="string"?t:t[r]}),P=f(e=>{if(!l||!i||!K||e.key!=="Escape"||V.current)return;const r=p.current.floatingContext?.nodeId,t=C?N(C.nodesRef.current,r):[];if(!Y&&t.length>0){let m=!0;if(t.forEach(d=>{d.context?.open&&!d.context.dataRef.current.__escapeKeyBubbles&&(m=!1)}),!m)return}const b=We(e)?e.nativeEvent:e,c=x(_e,b);n.setOpen(!1,c),!Y&&!c.isPropagationAllowed&&e.stopPropagation()}),ye=f(e=>{const r=k();return r==="intentional"&&e.type!=="click"||r==="sloppy"&&e.type==="click"}),R=f(()=>{p.current.insideReactTree=!0,ne.start(0,S)}),M=f((e,r=!1)=>{if(ye(e)){S();return}if(p.current.insideReactTree){S();return}if(k()==="intentional"&&r||typeof L=="function"&&!L(e))return;const t=I(e),b=`[${Ye("inert")}]`,c=fe(n.select("floatingElement")).querySelectorAll(b),m=n.context.triggerElements;if(t&&(m.hasElement(t)||m.hasMatchingElement(E=>B(E,t))))return;let d=O(t)?t:null;for(;d&&!Q(d);){const E=Oe(d);if(Q(E)||!O(E))break;d=E}if(c.length&&O(t)&&!Ne(t)&&!B(t,n.select("floatingElement"))&&Array.from(c).every(E=>!B(d,E)))return;if(Ie(t)&&!("touches"in e)){const E=Q(t),D=Me(t),ae=/auto|scroll/,Re=E||ae.test(D.overflowX),we=E||ae.test(D.overflowY),Ce=Re&&t.clientWidth>0&&t.scrollWidth>t.clientWidth,Le=we&&t.clientHeight>0&&t.scrollHeight>t.clientHeight,Se=D.direction==="rtl",ke=Le&&(Se?e.offsetX<=t.offsetWidth-t.clientWidth:e.offsetX>t.clientWidth),De=Ce&&e.offsetY>t.clientHeight;if(ke||De)return}const ce=p.current.floatingContext?.nodeId,Pe=C&&N(C.nodesRef.current,ce).some(E=>v(e,E.context?.elements.floating));if(v(e,n.select("floatingElement"))||v(e,n.select("domReferenceElement"))||Pe)return;const ie=C?N(C.nodesRef.current,ce):[];if(ie.length>0){let E=!0;if(ie.forEach(D=>{D.context?.open&&!D.context.dataRef.current.__outsidePressBubbles&&(E=!1)}),!E)return}n.setOpen(!1,x(Xe,e)),S()}),oe=f(e=>{k()!=="sloppy"||e.pointerType==="touch"||!n.select("open")||!i||v(e,n.select("floatingElement"))||v(e,n.select("domReferenceElement"))||M(e)}),Te=f(e=>{if(k()!=="sloppy"||!n.select("open")||!i||v(e,n.select("floatingElement"))||v(e,n.select("domReferenceElement")))return;const r=e.touches[0];r&&(g.current={startTime:Date.now(),startX:r.clientX,startY:r.clientY,dismissOnTouchEnd:!1,dismissOnMouseDown:!0},_.start(1e3,()=>{g.current&&(g.current.dismissOnTouchEnd=!1,g.current.dismissOnMouseDown=!1)}))}),$=f(e=>{const r=I(e);function t(){Te(e),r?.removeEventListener(e.type,t)}r?.addEventListener(e.type,t)}),w=f(e=>{const r=U.current;if(U.current=!1,_.clear(),e.type==="mousedown"&&g.current&&!g.current.dismissOnMouseDown)return;const t=I(e);function b(){e.type==="pointerdown"?oe(e):M(e,r),t?.removeEventListener(e.type,b)}t?.addEventListener(e.type,b)}),be=f(e=>{if(k()!=="sloppy"||!g.current||v(e,n.select("floatingElement"))||v(e,n.select("domReferenceElement")))return;const r=e.touches[0];if(!r)return;const t=Math.abs(r.clientX-g.current.startX),b=Math.abs(r.clientY-g.current.startY),c=Math.sqrt(t*t+b*b);c>5&&(g.current.dismissOnTouchEnd=!0),c>10&&(M(e),_.clear(),g.current=null)}),j=f(e=>{const r=I(e);function t(){be(e),r?.removeEventListener(e.type,t)}r?.addEventListener(e.type,t)}),ve=f(e=>{k()!=="sloppy"||!g.current||v(e,n.select("floatingElement"))||v(e,n.select("domReferenceElement"))||(g.current.dismissOnTouchEnd&&M(e),_.clear(),g.current=null)}),G=f(e=>{const r=I(e);function t(){ve(e),r?.removeEventListener(e.type,t)}r?.addEventListener(e.type,t)});h.useEffect(()=>{if(!l||!i)return;p.current.__escapeKeyBubbles=Y,p.current.__outsidePressBubbles=te;const e=new Ke;function r(d){n.setOpen(!1,x(Be,d))}function t(){e.clear(),V.current=!0}function b(){e.start(xe()?5:0,()=>{V.current=!1})}const c=fe(o);c.addEventListener("pointerdown",q,!0),K&&(c.addEventListener("keydown",P),c.addEventListener("compositionstart",t),c.addEventListener("compositionend",b)),L&&(c.addEventListener("click",w,!0),c.addEventListener("pointerdown",w,!0),c.addEventListener("touchstart",$,!0),c.addEventListener("touchmove",j,!0),c.addEventListener("touchend",G,!0),c.addEventListener("mousedown",w,!0));let m=[];return ee&&(O(u)&&(m=Z(u)),O(o)&&(m=m.concat(Z(o))),!O(a)&&a&&a.contextElement&&(m=m.concat(Z(a.contextElement)))),m=m.filter(d=>d!==c.defaultView?.visualViewport),m.forEach(d=>{d.addEventListener("scroll",r,{passive:!0})}),()=>{c.removeEventListener("pointerdown",q,!0),K&&(c.removeEventListener("keydown",P),c.removeEventListener("compositionstart",t),c.removeEventListener("compositionend",b)),L&&(c.removeEventListener("click",w,!0),c.removeEventListener("pointerdown",w,!0),c.removeEventListener("touchstart",$,!0),c.removeEventListener("touchmove",j,!0),c.removeEventListener("touchend",G,!0),c.removeEventListener("mousedown",w,!0)),m.forEach(d=>{d.removeEventListener("scroll",r)}),e.clear()}},[p,o,a,u,K,L,l,T,ee,i,Y,te,P,M,w,oe,$,j,G,q,n]),h.useEffect(S,[L,S]);const J=h.useMemo(()=>({onKeyDown:P,...z&&{[He[H]]:e=>{n.setOpen(!1,x(ue,e.nativeEvent))},...H!=="intentional"&&{onClick(e){n.setOpen(!1,x(ue,e.nativeEvent))}}}}),[P,n,z,H]),X=f(e=>{const r=I(e.nativeEvent);!B(n.select("floatingElement"),r)||e.button!==0||(U.current=!0)}),re=h.useMemo(()=>({onKeyDown:P,onPointerDown:X,onMouseDown:X,onMouseUp:X,onClickCapture:R,onMouseDownCapture:R,onPointerDownCapture:R,onMouseUpCapture:R,onTouchEndCapture:R,onTouchMoveCapture:R}),[P,X,R]);return h.useMemo(()=>i?{reference:J,floating:re,trigger:J}:{},[i,J,re])}function nt(s=[]){const y=s.map(i=>i?.reference),n=s.map(i=>i?.floating),l=s.map(i=>i?.item),o=s.map(i=>i?.trigger),a=h.useCallback(i=>W(i,s,"reference"),y),u=h.useCallback(i=>W(i,s,"floating"),n),T=h.useCallback(i=>W(i,s,"item"),l),p=h.useCallback(i=>W(i,s,"trigger"),o);return h.useMemo(()=>({getReferenceProps:a,getFloatingProps:u,getItemProps:T,getTriggerProps:p}),[a,u,T,p])}function W(s,y,n){const l=new Map,o=n==="item",a={};n==="floating"&&(a.tabIndex=-1,a[Fe]="");for(const u in s)o&&s&&(u===pe||u===me)||(a[u]=s[u]);for(let u=0;u<y.length;u+=1){let T;const p=y[u]?.[n];typeof p=="function"?T=s?p(s):null:T=p,T&&de(a,T,o,l)}return de(a,s,o,l),a}function de(s,y,n,l){for(const o in y){const a=y[o];n&&(o===pe||o===me)||(o.startsWith("on")?(l.has(o)||l.set(o,[]),typeof a=="function"&&(l.get(o)?.push(a),s[o]=(...u)=>l.get(o)?.map(T=>T(...u)).find(T=>T!==void 0))):s[o]=a)}}export{nt as a,et as b,N as g,tt as u};
