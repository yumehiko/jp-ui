import{r as p}from"./iframe-DEeGeQmx.js";import{C as oe}from"./useCompositeListItem-BgXMeN-J.js";import{i as se}from"./isElementDisabled-CwHw_lZC.js";import{u as Z}from"./useStableCallback-DO7h5Pr5.js";import{a as ie,E as q,e as re,u as ae}from"./mergeClassName-BNAeu4iQ.js";import{s as v,d as le,e as de,i as J,A as P,b as j,H as ce,E as fe,c as $,a as B,V as ue,f as he,g as ge,h as me,M as Ie}from"./composite-CJk-2jGs.js";import{g as pe,a as xe,c as Re,b as U,d as Ee,e as ye,f as Ce,h as Ae,i as Ke}from"./composite-BpyLfiE4.js";import{C as be}from"./useButton-BfHs0Tuu.js";import{u as Me}from"./DirectionContext-Bpzfmgnk.js";import{j as Q}from"./jsx-runtime-u17CrQMm.js";const _e="data-composite-item-active",Se=[];function ke(x){const{itemSizes:C,cols:a=1,loopFocus:R=!0,dense:_=!1,orientation:o="both",direction:E,highlightedIndex:w,onHighlightedIndexChange:z,rootRef:D,enableHomeAndEndKeys:h=!1,stopEventPropagation:S=!1,disabledIndices:i,modifierKeys:k=Se}=x,[N,G]=p.useState(0),A=a>1,g=p.useRef(null),H=ie(g,D),t=p.useRef([]),K=p.useRef(!1),r=w??N,m=Z((e,s=!1)=>{if((z??G)(e),s){const d=t.current[e];v(g.current,d,E,o)}}),O=Z(e=>{if(e.size===0||K.current)return;K.current=!0;const s=Array.from(e.keys()),d=s.find(l=>l?.hasAttribute(_e))??null,c=d?s.indexOf(d):-1;c!==-1&&m(c),v(g.current,d,E,o)}),b=p.useMemo(()=>({"aria-orientation":o==="both"?void 0:o,ref:H,onFocus(e){!g.current||!J(e.target)||e.target.setSelectionRange(0,e.target.value.length??0)},onKeyDown(e){const s=h?le:de;if(!s.has(e.key)||He(e,k)||!g.current)return;const c=E==="rtl",l=c?$:j,W={horizontal:l,vertical:P,both:l}[o],y=c?j:$,T={horizontal:y,vertical:B,both:y}[o];if(J(e.target)&&!se(e.target)){const I=e.target.selectionStart,f=e.target.selectionEnd,F=e.target.value??"";if(I==null||e.shiftKey||I!==f||e.key!==T&&I<F.length||e.key!==W&&I>0)return}let n=r;const Y=pe(t,i),L=xe(t,i);if(A){const I=C||Array.from({length:t.current.length},()=>({width:1,height:1})),f=Re(I,a,_),F=f.findIndex(u=>u!=null&&!U(t,u,i)),te=f.reduce((u,M,ne)=>M!=null&&!U(t,M,i)?ne:u,-1);n=f[Ee({current:f.map(u=>u?t.current[u]:null)},{event:e,orientation:o,loopFocus:R,cols:a,disabledIndices:Ce([...i||t.current.map((u,M)=>U(t,M)?M:void 0),void 0],f),minIndex:F,maxIndex:te,prevIndex:ye(r>L?Y:r,I,f,a,e.key===P?"bl":e.key===j?"tr":"tl"),rtl:c})]}const X={horizontal:[l],vertical:[P],both:[l,P]}[o],V={horizontal:[y],vertical:[B],both:[y,B]}[o],ee=A?s:{horizontal:h?ge:me,vertical:h?ue:he,both:s}[o];h&&(e.key===ce?n=Y:e.key===fe&&(n=L)),n===r&&(X.includes(e.key)||V.includes(e.key))&&(R&&n===L&&X.includes(e.key)?n=Y:R&&n===Y&&V.includes(e.key)?n=L:n=Ae(t,{startingIndex:n,decrement:V.includes(e.key),disabledIndices:i})),n!==r&&!Ke(t,n)&&(S&&e.stopPropagation(),ee.has(e.key)&&e.preventDefault(),m(n,!0),queueMicrotask(()=>{t.current[n]?.focus()}))}}),[a,_,E,i,t,h,r,A,C,R,H,k,m,o,S]);return p.useMemo(()=>({props:b,highlightedIndex:r,onHighlightedIndexChange:m,elementsRef:t,disabledIndices:i,onMapChange:O,relayKeyboardEvent:b.onKeyDown}),[b,r,m,t,i,O])}function He(x,C){for(const a of Ie.values())if(!C.includes(a)&&x.getModifierState(a))return!0;return!1}function We(x){const{render:C,className:a,refs:R=q,props:_=q,state:o=re,stateAttributesMapping:E,highlightedIndex:w,onHighlightedIndexChange:z,orientation:D,dense:h,itemSizes:S,loopFocus:i,cols:k,enableHomeAndEndKeys:N,onMapChange:G,stopEventPropagation:A=!0,rootRef:g,disabledIndices:H,modifierKeys:t,highlightItemOnHover:K=!1,tag:r="div",...m}=x,O=Me(),{props:b,highlightedIndex:e,onHighlightedIndexChange:s,elementsRef:d,onMapChange:c,relayKeyboardEvent:l}=ke({itemSizes:S,cols:k,loopFocus:i,dense:h,orientation:D,highlightedIndex:w,onHighlightedIndexChange:z,rootRef:g,stopEventPropagation:A,enableHomeAndEndKeys:N,direction:O,disabledIndices:H,modifierKeys:t}),W=ae(r,x,{state:o,ref:R,props:[b,..._,m],stateAttributesMapping:E}),y=p.useMemo(()=>({highlightedIndex:e,onHighlightedIndexChange:s,highlightItemOnHover:K,relayKeyboardEvent:l}),[e,s,K,l]);return Q.jsx(be.Provider,{value:y,children:Q.jsx(oe,{elementsRef:d,onMapChange:T=>{G?.(T),c(T)},children:W})})}export{_e as A,We as C};
