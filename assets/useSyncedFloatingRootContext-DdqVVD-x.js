import{r as f}from"./iframe-DEeGeQmx.js";import{u as T}from"./useStableCallback-DO7h5Pr5.js";import{b as m,e as p,d as v}from"./mergeClassName-BNAeu4iQ.js";import{u as S}from"./useTransitionStatus-cB-ptfQy.js";import{u as C}from"./useOpenChangeComplete-Ph1DesCe.js";import{g as x}from"./getEmptyRootContext-BpSj7kNH.js";import{c as o,i as I,G as O}from"./popupStateMapping-B9bpgTNS.js";import{u as R}from"./useId-H7dhCfMg.js";import{f as y}from"./floating-ui.utils.dom-CWuwp5es.js";function P(e,t){const n=f.useRef(null);return f.useCallback(i=>{e!==void 0&&(n.current!==null&&(t.context.triggerElements.delete(n.current),n.current=null),i!==null&&(n.current=e,t.context.triggerElements.add(e,i)))},[t,e])}function j(e,t,n,i){const r=n.useState("isMountedByTrigger",e),s=P(e,n),u=T(a=>{s(a),a!==null&&n.select("open")&&n.select("activeTriggerId")==null&&n.update({activeTriggerId:e,activeTriggerElement:a,...i})});return m(()=>{r&&n.update({activeTriggerElement:t.current,...i})},[r,n,t,...Object.values(i)]),{registerTrigger:u,isMountedByThisTrigger:r}}function z(e){const t=e.useState("open");m(()=>{if(t&&!e.select("activeTriggerId")&&e.context.triggerElements.size===1){const n=e.context.triggerElements.entries().next();if(!n.done){const[i,r]=n.value;e.update({activeTriggerId:i,activeTriggerElement:r})}}},[t,e])}function D(e,t,n){const{mounted:i,setMounted:r,transitionStatus:s}=S(e);t.useSyncedValues({mounted:i,transitionStatus:s});const u=T(()=>{r(!1),t.update({activeTriggerId:null,activeTriggerElement:null,mounted:!1}),n?.(),t.context.onOpenChangeComplete?.(!1)}),a=t.useState("preventUnmountingOnClose");return C({enabled:!a,open:e,ref:t.context.popupRef,onComplete(){e||u()}}),{forceUnmount:u,transitionStatus:s}}function G(){return{open:!1,mounted:!1,transitionStatus:"idle",floatingRootContext:x(),preventUnmountingOnClose:!1,payload:void 0,activeTriggerId:null,activeTriggerElement:null,popupElement:null,positionerElement:null,activeTriggerProps:p,inactiveTriggerProps:p,popupProps:p}}const J={open:o(e=>e.open),mounted:o(e=>e.mounted),transitionStatus:o(e=>e.transitionStatus),floatingRootContext:o(e=>e.floatingRootContext),preventUnmountingOnClose:o(e=>e.preventUnmountingOnClose),payload:o(e=>e.payload),activeTriggerId:o(e=>e.activeTriggerId),activeTriggerElement:o(e=>e.mounted?e.activeTriggerElement:null),isTriggerActive:o((e,t)=>t!==void 0&&e.activeTriggerId===t),isOpenedByTrigger:o((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.open),isMountedByTrigger:o((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.mounted),triggerProps:o((e,t)=>t?e.activeTriggerProps:e.inactiveTriggerProps),popupProps:o(e=>e.popupProps),popupElement:o(e=>e.popupElement),positionerElement:o(e=>e.positionerElement)};function L(e){const{popupStore:t,noEmit:n=!1,treatPopupAsFloatingElement:i=!1,onOpenChange:r}=e,s=R(),u=I()!=null,a=t.useState("open"),g=t.useState("activeTriggerElement"),c=t.useState(i?"popupElement":"positionerElement"),E=t.context.triggerElements,l=v(()=>new O({open:a,referenceElement:g,floatingElement:c,triggerElements:E,onOpenChange:r,floatingId:s,nested:u,noEmit:n})).current;return m(()=>{const d={open:a,floatingId:s,referenceElement:g,floatingElement:c};y(g)&&(d.domReferenceElement=g),l.update(d)},[a,s,g,c,l]),l.context.onOpenChange=r,l.context.nested=u,l.context.noEmit=n,l}export{D as a,L as b,G as c,j as d,P as e,J as p,z as u};
