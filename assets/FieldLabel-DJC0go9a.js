import{r as a}from"./iframe-CbECxjq5.js";import{u as A}from"./useStableCallback-D6w4asaT.js";import{a as J,L as te,b as Q,D as K,g as H,d as ae,f as W,u as ie}from"./LabelableContext-P5lwU5Pp.js";import{u as se}from"./FieldsetRootContext-CtfBA5DW.js";import{c as Y,e as re,u as X,b as ne}from"./mergeClassName-IXwn37SS.js";import{u as oe}from"./useTimeout-BMAPPt2Y.js";import{j as B}from"./jsx-runtime-u17CrQMm.js";import{u as Z}from"./useBaseUiId-DYV6Jlu1.js";import{g as le}from"./element-C8qsRkBu.js";const de=function(e){const n=Z(),[y,h]=a.useState(e.initialControlId===void 0?n:e.initialControlId),[V,M]=a.useState(void 0),[p,I]=a.useState([]),{messageIds:o}=J(),c=a.useCallback(f=>Y({"aria-describedby":o.concat(p).join(" ")||void 0},f),[o,p]),r=a.useMemo(()=>({controlId:y,setControlId:h,labelId:V,setLabelId:M,messageIds:p,setMessageIds:I,getDescriptionProps:c}),[y,h,V,M,p,I,c]);return B.jsx(te.Provider,{value:r,children:e.children})},U=Object.keys(K);function ue(g){if(!g||g.valid||!g.valueMissing)return!1;let e=!1;for(const n of U)n!=="valid"&&(n==="valueMissing"&&(e=g[n]),g[n]&&(e=!1));return e}function ce(g){const{formRef:e,clearErrors:n}=Q(),{setValidityData:y,validate:h,validityData:V,validationDebounceTime:M,invalid:p,markedDirtyRef:I,state:o,name:c,shouldValidateOnChange:r}=g,{controlId:f,getDescriptionProps:L}=J(),v=oe(),P=a.useRef(null),C=A(async(m,x=!1)=>{const t=P.current;if(!t)return;if(x){if(o.valid!==!1)return;const d=t.validity;if(!d.valueMissing){const u={value:m,state:{...K,valid:!0},error:"",errors:[],initialValue:V.initialValue};if(t.setCustomValidity(""),f){const i=e.current.fields.get(f);i&&e.current.fields.set(f,{...i,...H(u,!1)})}y(u);return}const s=U.reduce((u,i)=>(u[i]=d[i],u),{});if(!s.valid&&!ue(s))return}function _(d){const s=U.reduce((i,T)=>(i[T]=d.validity[T],i),{});let u=!1;for(const i of U)if(i!=="valid"){if(i==="valueMissing"&&s[i])u=!0;else if(s[i])return s}return u&&!I.current&&(s.valid=!0,s.valueMissing=!1),s}v.clear();let l=null,b=[];const D=_(t);let R;const j=r();if(t.validationMessage&&!j)R=t.validationMessage,b=[t.validationMessage];else{const d=Array.from(e.current.fields.values()).reduce((u,i)=>(i.name&&(u[i.name]=i.getValue()),u),{}),s=h(m,d);typeof s=="object"&&s!==null&&"then"in s?l=await s:l=s,l!==null?(D.valid=!1,D.customError=!0,Array.isArray(l)?(b=l,t.setCustomValidity(l.join(`
`))):l&&(b=[l],t.setCustomValidity(l))):j&&(t.setCustomValidity(""),D.customError=!1,t.validationMessage?(R=t.validationMessage,b=[t.validationMessage]):t.validity.valid&&!D.valid&&(D.valid=!0))}const F={value:m,state:D,error:R??(Array.isArray(l)?l[0]:l??""),errors:b,initialValue:V.initialValue};if(f){const d=e.current.fields.get(f);d&&e.current.fields.set(f,{...d,...H(F,p)})}y(F)}),S=a.useCallback((m={})=>Y(L,o.valid===!1?{"aria-invalid":!0}:re,m),[L,o.valid]),E=a.useCallback((m={})=>Y({onChange(x){if(x.nativeEvent.defaultPrevented)return;if(n(c),!r()){C(x.currentTarget.value,!0);return}if(p)return;const t=x.currentTarget;if(t.value===""){C(t.value);return}v.clear(),M?v.start(M,()=>{C(t.value)}):C(t.value)}},S(m)),[S,n,c,v,C,p,M,r]);return a.useMemo(()=>({getValidationProps:S,getInputValidationProps:E,inputRef:P,commit:C}),[S,E,C])}const fe=a.forwardRef(function(e,n){const{errors:y,validationMode:h,submitAttemptedRef:V}=Q(),{render:M,className:p,validate:I,validationDebounceTime:o=0,validationMode:c=h,name:r,disabled:f=!1,invalid:L,dirty:v,touched:P,...C}=e,{disabled:S}=se(),E=A(I||(()=>null)),m=S||f,[x,t]=a.useState(!1),[_,l]=a.useState(!1),[b,D]=a.useState(!1),[R,j]=a.useState(!1),F=v??_,d=P??x,s=a.useRef(!1),u=A(N=>{v===void 0&&(N&&(s.current=!0),l(N))}),i=A(N=>{P===void 0&&t(N)}),T=A(()=>c==="onChange"||c==="onSubmit"&&V.current),O=!!(L||r&&{}.hasOwnProperty.call(y,r)&&y[r]!==void 0),[w,q]=a.useState({state:K,error:"",errors:[],value:null,initialValue:null}),z=!O&&w.state.valid,k=a.useMemo(()=>({disabled:m,touched:d,dirty:F,valid:z,filled:b,focused:R}),[m,d,F,z,b,R]),G=ce({setValidityData:q,validate:E,validityData:w,validationDebounceTime:o,invalid:O,markedDirtyRef:s,state:k,name:r,shouldValidateOnChange:T}),$=a.useMemo(()=>({invalid:O,name:r,validityData:w,setValidityData:q,disabled:m,touched:d,setTouched:i,dirty:F,setDirty:u,filled:b,setFilled:D,focused:R,setFocused:j,validate:E,validationMode:c,validationDebounceTime:o,shouldValidateOnChange:T,state:k,markedDirtyRef:s,validation:G}),[O,r,w,m,d,i,F,u,b,D,R,j,E,c,o,T,k,G]),ee=X("div",e,{ref:n,state:k,props:C,stateAttributesMapping:W});return B.jsx(ae.Provider,{value:$,children:ee})}),De=a.forwardRef(function(e,n){return B.jsx(de,{children:B.jsx(fe,{...e,ref:n})})}),Ie=a.forwardRef(function(e,n){const{render:y,className:h,id:V,...M}=e,p=ie(!1),{controlId:I,setLabelId:o,labelId:c}=J(),r=Z(V),f=a.useRef(null);return ne(()=>(r&&o(r),()=>{o(void 0)}),[r,o]),X("label",e,{ref:[n,f],state:p.state,props:[{id:c,htmlFor:I??void 0,onMouseDown(v){le(v.nativeEvent)?.closest("button,input,select,textarea")||!v.defaultPrevented&&v.detail>1&&v.preventDefault()}},M],stateAttributesMapping:W})});export{De as F,Ie as a};
