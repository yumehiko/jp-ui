import{r as m}from"./iframe-CbECxjq5.js";import{u as $}from"./useAnimationFrame-CwwnCJKI.js";import{e as O,b as B}from"./mergeClassName-IXwn37SS.js";import{u as E}from"./useStableCallback-D6w4asaT.js";import{a as D}from"./useOpenChangeComplete-DeoJGa5O.js";import{g as L}from"./getCssDimensions-Bjp7kr5Y.js";const F=typeof ResizeObserver<"u",T=()=>!0;function H(u){const{popupElement:e,positionerElement:t,content:c,mounted:f,enabled:P=T,onMeasureLayout:A,onMeasureLayoutComplete:C,side:s,direction:b}=u,h=m.useRef(!0),g=D(e,!0,!1),y=$(),o=m.useRef(null),x=E(A),d=E(C),w=m.useMemo(()=>{let r=s==="top",i=s==="left";return b==="rtl"?(r=r||s==="inline-end",i=i||s==="inline-end"):(r=r||s==="inline-start",i=i||s==="inline-start"),r?{position:"absolute",[s==="top"?"bottom":"top"]:"0",[i?"right":"left"]:"0"}:O},[s,b]);B(()=>{if(!f||!P()||!F){h.current=!0,o.current=null;return}if(!e||!t)return;Object.entries(w).forEach(([n,p])=>{e.style.setProperty(n,p)});const r=new ResizeObserver(n=>{const p=n[0];p&&(o.current===null?o.current={width:Math.ceil(p.borderBoxSize[0].inlineSize),height:Math.ceil(p.borderBoxSize[0].blockSize)}:(o.current.width=Math.ceil(p.borderBoxSize[0].inlineSize),o.current.height=Math.ceil(p.borderBoxSize[0].blockSize)))});r.observe(e),e.style.setProperty("--popup-width","auto"),e.style.setProperty("--popup-height","auto");const i=l(e,"position","static"),S=l(e,"transform","none"),R=l(e,"scale","1"),z=l(t,"--available-width","max-content"),M=l(t,"--available-height","max-content");if(x?.(),h.current||o.current===null){t.style.setProperty("--positioner-width","max-content"),t.style.setProperty("--positioner-height","max-content");const n=L(e);return t.style.setProperty("--positioner-width",`${n.width}px`),t.style.setProperty("--positioner-height",`${n.height}px`),i(),S(),R(),z(),M(),d?.(null,n),h.current=!1,()=>{r.disconnect()}}e.style.setProperty("--popup-width","auto"),e.style.setProperty("--popup-height","auto"),t.style.setProperty("--positioner-width","max-content"),t.style.setProperty("--positioner-height","max-content");const a=L(e);e.style.setProperty("--popup-width",`${o.current.width}px`),e.style.setProperty("--popup-height",`${o.current.height}px`),i(),S(),z(),M(),d?.(o.current,a),t.style.setProperty("--positioner-width",`${a.width}px`),t.style.setProperty("--positioner-height",`${a.height}px`);const v=new AbortController;return y.request(()=>{e.style.setProperty("--popup-width",`${a.width}px`),e.style.setProperty("--popup-height",`${a.height}px`),g(()=>{e.style.setProperty("--popup-width","auto"),e.style.setProperty("--popup-height","auto")},v.signal)}),()=>{r.disconnect(),v.abort(),y.cancel()}},[c,e,t,g,y,P,f,x,d,w])}function l(u,e,t){const c=u.style.getPropertyValue(e);return u.style.setProperty(e,t),()=>{u.style.setProperty(e,c)}}export{H as u};
