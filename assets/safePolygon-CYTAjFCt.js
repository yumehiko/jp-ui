import{r as b}from"./iframe-DEeGeQmx.js";import{f as re}from"./floating-ui.utils.dom-CWuwp5es.js";import{u as se,T as le}from"./useTimeout-DA2ibUVR.js";import{u as ee}from"./useValueAsRef-BrOSccPP.js";import{u as U}from"./useStableCallback-DO7h5Pr5.js";import{b as ie}from"./mergeClassName-BNAeu4iQ.js";import{f as ae,i as de,B as me}from"./popupStateMapping-B9bpgTNS.js";import{c as G,m as J}from"./createBaseUIEventDetails-BeElkf0B.js";import{T as ge}from"./constants-CNjsXAL1.js";import{d as x,g as fe,c as K}from"./element-C8qsRkBu.js";import{b as oe}from"./event-CNRsvx7q.js";import{g as Ee}from"./useInteractions-BbDBxniS.js";const ce=me("safe-polygon"),ve=`button,[role="button"],select,[tabindex]:not([tabindex="-1"]),${ge}`;function he(c){return c?!!c.closest(ve):!1}function te(c,e,s){if(s&&!oe(s))return 0;if(typeof c=="number")return c;if(typeof c=="function"){const f=c();return typeof f=="number"?f:f?.[e]}return c?.[e]}function ne(c){return typeof c=="function"?c():c}function Se(c,e={}){const s="rootStore"in c?c.rootStore:c,f=s.useState("open"),d=s.useState("floatingElement"),h=s.useState("domReferenceElement"),{dataRef:g,events:k}=s.context,{enabled:m=!0,delay:j=0,handleClose:V=null,mouseOnly:E=!1,restMs:w=0,move:X=!0,triggerElement:y=null,externalTree:W}=e,B=ae(W),$=de(),S=ee(V),C=ee(j),F=ee(w),I=b.useRef(void 0),_=b.useRef(!1),R=se(),q=b.useRef(void 0),T=se(),Q=b.useRef(!0),z=b.useRef(!1),u=b.useRef(()=>{}),t=b.useRef(!1),Y=U(()=>{const o=g.current.openEvent?.type;return o?.includes("mouse")&&o!=="mousedown"}),v=U(()=>_.current?!0:g.current.openEvent?["click","mousedown"].includes(g.current.openEvent.type):!1);b.useEffect(()=>{if(!m)return;function o(i){i.open||(R.clear(),T.clear(),Q.current=!0,t.current=!1)}return k.on("openchange",o),()=>{k.off("openchange",o)}},[m,k,R,T]),b.useEffect(()=>{if(!m||!S.current||!f)return;function o(a){v()||Y()&&s.setOpen(!1,G(J,a,a.currentTarget??void 0))}const i=x(d).documentElement;return i.addEventListener("mouseleave",o),()=>{i.removeEventListener("mouseleave",o)}},[d,f,s,m,S,Y,v]);const L=b.useCallback((o,i=!0)=>{const a=te(C.current,"close",I.current);a&&!q.current?R.start(a,()=>s.setOpen(!1,G(J,o))):i&&(R.clear(),s.setOpen(!1,G(J,o)))},[C,s,R]),H=U(()=>{u.current(),q.current=void 0}),l=U(()=>{if(z.current){const o=x(d).body;o.style.pointerEvents="",o.removeAttribute(ce),z.current=!1}}),P=U(o=>{const i=fe(o);if(!he(i)){_.current=!1;return}_.current=!0});b.useEffect(()=>{if(!m)return;function o(n){if(R.clear(),Q.current=!1,E&&!oe(I.current)||ne(F.current)>0&&!te(C.current,"open"))return;const p=te(C.current,"open",I.current),M=n.currentTarget??void 0,A=s.select("domReferenceElement"),Z=A&&M&&!K(A,M);p?R.start(p,()=>{s.select("open")||s.setOpen(!0,G(J,n,M))}):(!f||Z)&&s.setOpen(!0,G(J,n,M))}function i(n){if(v()){l();return}u.current();const p=x(d);T.clear(),t.current=!1;const M=s.context.triggerElements;if(n.relatedTarget&&M.hasElement(n.relatedTarget))return;if(S.current&&g.current.floatingContext){f||R.clear(),q.current=S.current({...g.current.floatingContext,tree:B,x:n.clientX,y:n.clientY,onClose(){l(),H(),v()||L(n,!0)}});const Z=q.current;p.addEventListener("mousemove",Z),u.current=()=>{p.removeEventListener("mousemove",Z)};return}(I.current!=="touch"||!K(d,n.relatedTarget))&&L(n)}function a(n){if(v()||!g.current.floatingContext||!s.select("open"))return;const p=s.context.triggerElements;n.relatedTarget&&p.hasElement(n.relatedTarget)||S.current?.({...g.current.floatingContext,tree:B,x:n.clientX,y:n.clientY,onClose(){l(),H(),v()||L(n)}})(n)}function O(){R.clear(),l()}function D(n){v()||L(n,!1)}const r=y??h;if(re(r)){const n=d;return f&&r.addEventListener("mouseleave",a),X&&r.addEventListener("mousemove",o,{once:!0}),r.addEventListener("mouseenter",o),r.addEventListener("mouseleave",i),n&&(n.addEventListener("mouseleave",a),n.addEventListener("mouseenter",O),n.addEventListener("mouseleave",D),n.addEventListener("pointerdown",P,!0)),()=>{f&&r.removeEventListener("mouseleave",a),X&&r.removeEventListener("mousemove",o),r.removeEventListener("mouseenter",o),r.removeEventListener("mouseleave",i),n&&(n.removeEventListener("mouseleave",a),n.removeEventListener("mouseenter",O),n.removeEventListener("mouseleave",D),n.removeEventListener("pointerdown",P,!0))}}},[m,E,X,h,d,y,s,L,H,l,f,B,C,S,g,v,F,R,T,P]),ie(()=>{if(m&&f&&S.current?.__options?.blockPointerEvents&&Y()){z.current=!0;const o=d;if(re(h)&&o){const i=x(d).body;i.setAttribute(ce,"");const a=h,O=B?.nodesRef.current.find(D=>D.id===$)?.context?.elements.floating;return O&&(O.style.pointerEvents=""),i.style.pointerEvents="none",a.style.pointerEvents="auto",o.style.pointerEvents="auto",()=>{i.style.pointerEvents="",a.style.pointerEvents="",o.style.pointerEvents=""}}}},[m,f,$,B,S,Y,h,d]),ie(()=>{f||(I.current=void 0,t.current=!1,_.current=!1,H(),l())},[f,H,l]),b.useEffect(()=>()=>{H(),R.clear(),T.clear(),_.current=!1},[m,h,H,R,T]),b.useEffect(()=>l,[l]);const N=b.useMemo(()=>{function o(i){I.current=i.pointerType}return{onPointerDown:o,onPointerEnter:o,onMouseMove(i){const{nativeEvent:a}=i,O=i.currentTarget,D=s.select("domReferenceElement")&&!K(s.select("domReferenceElement"),i.target);function r(){!Q.current&&(!s.select("open")||D)&&s.setOpen(!0,G(J,a,O))}E&&!oe(I.current)||s.select("open")&&!D||ne(F.current)===0||!D&&t.current&&i.movementX**2+i.movementY**2<2||(T.clear(),I.current==="touch"||D?r():(t.current=!0,T.start(ne(F.current),r)))}}},[E,s,F,T]);return b.useMemo(()=>m?{reference:N}:{},[m,N])}function ue(c,e){const[s,f]=c;let d=!1;const h=e.length;for(let g=0,k=h-1;g<h;k=g++){const[m,j]=e[g]||[0,0],[V,E]=e[k]||[0,0];j>=f!=E>=f&&s<=(V-m)*(f-j)/(E-j)+m&&(d=!d)}return d}function pe(c,e){return c[0]>=e.x&&c[0]<=e.x+e.width&&c[1]>=e.y&&c[1]<=e.y+e.height}function Fe(c={}){const{buffer:e=.5,blockPointerEvents:s=!1,requireIntent:f=!0}=c,d=new le;let h=!1,g=null,k=null,m=typeof performance<"u"?performance.now():0;function j(E,w){const X=performance.now(),y=X-m;if(g===null||k===null||y===0)return g=E,k=w,m=X,null;const W=E-g,B=w-k,S=Math.sqrt(W*W+B*B)/y;return g=E,k=w,m=X,S}const V=({x:E,y:w,placement:X,elements:y,onClose:W,nodeId:B,tree:$})=>function(C){function F(){d.clear(),W()}if(d.clear(),!y.domReference||!y.floating||X==null||E==null||w==null)return;const{clientX:I,clientY:_}=C,R=[I,_],q=fe(C),T=C.type==="mouseleave",Q=K(y.floating,q),z=K(y.domReference,q),u=y.domReference.getBoundingClientRect(),t=y.floating.getBoundingClientRect(),Y=X.split("-")[0],v=E>t.right-t.width/2,L=w>t.bottom-t.height/2,H=pe(R,u),l=t.width>u.width,P=t.height>u.height,N=(l?u:t).left,o=(l?u:t).right,i=(P?u:t).top,a=(P?u:t).bottom;if(Q&&(h=!0,!T))return;if(z&&(h=!1),z&&!T){h=!0;return}if(T&&re(C.relatedTarget)&&K(y.floating,C.relatedTarget)||$&&Ee($.nodesRef.current,B).some(({context:r})=>r?.open))return;if(Y==="top"&&w>=u.bottom-1||Y==="bottom"&&w<=u.top+1||Y==="left"&&E>=u.right-1||Y==="right"&&E<=u.left+1)return F();let O=[];switch(Y){case"top":O=[[N,u.top+1],[N,t.bottom-1],[o,t.bottom-1],[o,u.top+1]];break;case"bottom":O=[[N,t.top+1],[N,u.bottom-1],[o,u.bottom-1],[o,t.top+1]];break;case"left":O=[[t.right-1,a],[t.right-1,i],[u.left+1,i],[u.left+1,a]];break;case"right":O=[[u.right-1,a],[u.right-1,i],[t.left+1,i],[t.left+1,a]];break}function D([r,n]){switch(Y){case"top":{const p=[l?r+e/2:v?r+e*4:r-e*4,n+e+1],M=[l?r-e/2:v?r+e*4:r-e*4,n+e+1],A=[[t.left,v||l?t.bottom-e:t.top],[t.right,v?l?t.bottom-e:t.top:t.bottom-e]];return[p,M,...A]}case"bottom":{const p=[l?r+e/2:v?r+e*4:r-e*4,n-e],M=[l?r-e/2:v?r+e*4:r-e*4,n-e],A=[[t.left,v||l?t.top+e:t.bottom],[t.right,v?l?t.top+e:t.bottom:t.top+e]];return[p,M,...A]}case"left":{const p=[r+e+1,P?n+e/2:L?n+e*4:n-e*4],M=[r+e+1,P?n-e/2:L?n+e*4:n-e*4];return[...[[L||P?t.right-e:t.left,t.top],[L?P?t.right-e:t.left:t.right-e,t.bottom]],p,M]}case"right":{const p=[r-e,P?n+e/2:L?n+e*4:n-e*4],M=[r-e,P?n-e/2:L?n+e*4:n-e*4],A=[[L||P?t.left+e:t.right,t.top],[L?P?t.left+e:t.right:t.left+e,t.bottom]];return[p,M,...A]}default:return[]}}if(!ue([I,_],O)){if(h&&!H)return F();if(!T&&f){const r=j(C.clientX,C.clientY);if(r!==null&&r<.1)return F()}ue([I,_],D([E,w]))?!h&&f&&d.start(40,F):F()}};return V.__options={blockPointerEvents:s},V}export{te as g,Fe as s,Se as u};
