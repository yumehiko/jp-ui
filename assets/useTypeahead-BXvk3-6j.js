import{r as o}from"./iframe-CbECxjq5.js";import{u as S}from"./useStableCallback-D6w4asaT.js";import{E as D,b as E}from"./mergeClassName-IXwn37SS.js";import{u as U}from"./useTimeout-BMAPPt2Y.js";import{s as T}from"./event-CNRsvx7q.js";function H(l,b){const g="rootStore"in l?l.rootStore:l,s=g.useState("open"),u=g.context.dataRef,{listRef:O,activeIndex:p,onMatch:A,onTypingChange:R,enabled:h=!0,findMatch:L=null,resetMs:F=750,ignoreKeys:P=D,selectedIndex:y=null}=b,d=U(),r=o.useRef(""),i=o.useRef(y??p??-1),a=o.useRef(null);E(()=>{s&&(d.clear(),a.current=null,r.current="")},[s,d]),E(()=>{s&&r.current===""&&(i.current=y??p??-1)},[s,y,p]);const n=S(e=>{e?u.current.typing||(u.current.typing=e,R?.(e)):u.current.typing&&(u.current.typing=e,R?.(e))}),f=S(e=>{function x(c,w,I){const K=L?L(w,I):w.find(Y=>Y?.toLocaleLowerCase().indexOf(I.toLocaleLowerCase())===0);return K?c.indexOf(K):-1}const t=O.current;if(r.current.length>0&&r.current[0]!==" "&&(x(t,t,r.current)===-1?n(!1):e.key===" "&&T(e)),t==null||P.includes(e.key)||e.key.length!==1||e.ctrlKey||e.metaKey||e.altKey)return;s&&e.key!==" "&&(T(e),n(!0)),t.every(c=>c?c[0]?.toLocaleLowerCase()!==c[1]?.toLocaleLowerCase():!0)&&r.current===e.key&&(r.current="",i.current=a.current),r.current+=e.key,d.start(F,()=>{r.current="",i.current=a.current,n(!1)});const C=i.current,m=x(t,[...t.slice((C||0)+1),...t.slice(0,(C||0)+1)],r.current);m!==-1?(A?.(m),a.current=m):e.key!==" "&&(r.current="",n(!1))}),k=o.useMemo(()=>({onKeyDown:f}),[f]),M=o.useMemo(()=>({onKeyDown:f,onKeyUp(e){e.key===" "&&n(!1)}}),[f,n]);return o.useMemo(()=>h?{reference:k,floating:M}:{},[h,k,M])}export{H as u};
