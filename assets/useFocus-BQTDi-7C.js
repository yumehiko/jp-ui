import{r as s}from"./iframe-CbECxjq5.js";import{b as h,f as b,i as M}from"./floating-ui.utils.dom-CWuwp5es.js";import{f as F,e as D}from"./detectBrowser-CYw91I8L.js";import{u as k}from"./useTimeout-BMAPPt2Y.js";import{c as T,r as w,t as O,g as S}from"./createBaseUIEventDetails-Ca3whcAT.js";import{B as x}from"./popupStateMapping-Be-QQ-Fi.js";import{a as y,c as L,g as A,e as B,m as C,d as K}from"./element-C8qsRkBu.js";const g=F&&D;function z(c,R={}){const r="rootStore"in c?c.rootStore:c,{events:f,dataRef:E}=r.context,{enabled:o=!0,visibleOnly:p=!0}=R,a=s.useRef(!1),v=k(),m=s.useRef(!0);s.useEffect(()=>{const t=r.select("domReferenceElement");if(!o)return;const e=h(t);function i(){!r.select("open")&&M(t)&&t===y(K(t))&&(a.current=!0)}function u(){m.current=!0}function n(){m.current=!1}return e.addEventListener("blur",i),g&&(e.addEventListener("keydown",u,!0),e.addEventListener("pointerdown",n,!0)),()=>{e.removeEventListener("blur",i),g&&(e.removeEventListener("keydown",u,!0),e.removeEventListener("pointerdown",n,!0))}},[r,o]),s.useEffect(()=>{if(!o)return;function t(e){(e.reason===O||e.reason===S)&&(a.current=!0)}return f.on("openchange",t),()=>{f.off("openchange",t)}},[f,o]);const l=s.useMemo(()=>({onMouseLeave(){a.current=!1},onFocus(t){if(a.current)return;const e=A(t.nativeEvent);if(p&&b(e)){if(g&&!t.relatedTarget){if(!m.current&&!B(e))return}else if(!C(e))return}r.setOpen(!0,T(w,t.nativeEvent,t.currentTarget))},onBlur(t){a.current=!1;const e=t.relatedTarget,i=t.nativeEvent,u=b(e)&&e.hasAttribute(x("focus-guard"))&&e.getAttribute("data-type")==="outside";v.start(0,()=>{const n=r.select("domReferenceElement"),d=y(n?n.ownerDocument:document);!e&&d===n||L(E.current.floatingContext?.refs.floating.current,d)||L(n,d)||u||r.context.triggerElements.hasElement(t.relatedTarget)||r.setOpen(!1,T(w,i))})}}),[E,r,p,v]);return s.useMemo(()=>o?{reference:l,trigger:l}:{},[o,l])}export{z as u};
