import{r as f}from"./iframe-DEeGeQmx.js";import{i as we}from"./floating-ui.utils.dom-CWuwp5es.js";import{u as A}from"./useValueAsRef-BrOSccPP.js";import{u as ae}from"./useStableCallback-DO7h5Pr5.js";import{b as F}from"./mergeClassName-BNAeu4iQ.js";import{i as ze,f as Ge}from"./popupStateMapping-B9bpgTNS.js";import{c as Q,l as le,o as We}from"./createBaseUIEventDetails-BeElkf0B.js";import{e as _e}from"./InternalBackdrop-BHfnogQf.js";import{A as Z,a as W,b as _,c as Te}from"./constants-CNjsXAL1.js";import{i as Me,g as fe,a as ve,c as qe,b as de,d as He,e as $e,f as Be,h as X}from"./composite-BpyLfiE4.js";import{b as Ue,i as je,a as Pe,d as Je,c as Ce,g as Qe}from"./element-C8qsRkBu.js";import{s as T,i as Xe,a as Ye}from"./event-CNRsvx7q.js";const Ze="Escape";function ee(o,p,s){switch(o){case"vertical":return p;case"horizontal":return s;default:return p||s}}function Y(o,p){return ee(p,o===Te||o===Z,o===W||o===_)}function me(o,p,s){return ee(p,o===Z,s?o===W:o===_)||o==="Enter"||o===" "||o===""}function er(o,p,s){return ee(p,s?o===W:o===_,o===Z)}function rr(o,p,s,u){const g=s?o===_:o===W,x=o===Te;return p==="both"||p==="horizontal"&&u&&u>1?o===Ze:ee(p,g,x)}function pr(o,p){const s="rootStore"in o?o.rootStore:o,u=s.useState("open"),g=s.useState("floatingElement"),x=s.useState("domReferenceElement"),pe=s.context.dataRef,{listRef:n,activeIndex:b,onNavigate:Se=()=>{},enabled:E=!0,selectedIndex:k=null,allowEscape:ge=!1,loopFocus:re=!1,nested:w=!1,rtl:O=!1,virtual:d=!1,focusItemOnOpen:M="auto",focusItemOnHover:te=!0,openOnArrowKeyDown:ne=!0,disabledIndices:R=void 0,orientation:m="vertical",parentOrientation:Ie,cols:K=1,scrollItemIntoView:Ae=!0,itemSizes:Fe,dense:ke=!1,id:Re,resetOnPointerLeave:Ke=!0,externalTree:De}=p,Le=Ue(g),D=A(Le),q=ze(),v=Ge(De);F(()=>{pe.current.orientation=m},[pe,m]);const oe=je(x),P=f.useRef(M),t=f.useRef(k??-1),C=f.useRef(null),S=f.useRef(!0),a=ae(e=>{Se(t.current===-1?null:t.current,e)}),he=f.useRef(a),L=f.useRef(!!g),xe=f.useRef(u),h=f.useRef(!1),H=f.useRef(!1),ce=A(R),$=A(u),Ve=A(Ae),V=A(k),Oe=A(Ke),se=ae(()=>{function e(l){d?v?.events.emit("virtualfocus",l):_e(l,{sync:h.current,preventScroll:!0})}const c=n.current[t.current],r=H.current;c&&e(c),(h.current?l=>l():requestAnimationFrame)(()=>{const l=n.current[t.current]||c;if(!l)return;c||e(l);const I=Ve.current;I&&ie&&(r||!S.current)&&l.scrollIntoView?.(typeof I=="boolean"?{block:"nearest",inline:"nearest"}:I)})});F(()=>{E&&(u&&g?(t.current=k??-1,P.current&&k!=null&&(H.current=!0,a())):L.current&&(t.current=-1,he.current()))},[E,u,g,k,a]),F(()=>{if(E){if(!u){h.current=!1;return}if(g)if(b==null){if(h.current=!1,V.current!=null)return;if(L.current&&(t.current=-1,se()),(!xe.current||!L.current)&&P.current&&(C.current!=null||P.current===!0&&C.current==null)){let e=0;const c=()=>{n.current[0]==null?(e<2&&(e?requestAnimationFrame:queueMicrotask)(c),e+=1):(t.current=C.current==null||me(C.current,m,O)||w?fe(n):ve(n),C.current=null,a())};c()}}else Me(n,b)||(t.current=b,se(),H.current=!1)}},[E,u,g,b,V,w,n,m,O,a,se,ce]),F(()=>{if(!E||g||!v||d||!L.current)return;const e=v.nodesRef.current,c=e.find(l=>l.id===q)?.context?.elements.floating,r=Pe(Je(g)),i=e.some(l=>l.context&&Ce(l.context.elements.floating,r));c&&!i&&S.current&&c.focus({preventScroll:!0})},[E,g,v,q,d]),F(()=>{he.current=a,xe.current=u,L.current=!!g}),F(()=>{u||(C.current=null,P.current=M)},[u,M]);const Ee=b!=null,ie=f.useMemo(()=>{function e(r){if(!$.current)return;const i=n.current.indexOf(r.currentTarget);i!==-1&&t.current!==i&&(t.current=i,a(r))}return{onFocus(r){h.current=!0,e(r)},onClick:({currentTarget:r})=>r.focus({preventScroll:!0}),onMouseMove(r){h.current=!0,H.current=!1,te&&e(r)},onPointerLeave(r){if(!$.current||!S.current||r.pointerType==="touch")return;h.current=!0;const i=r.relatedTarget;!te||n.current.includes(i)||Oe.current&&(t.current=-1,a(r),d||D.current?.focus({preventScroll:!0}))}}},[$,D,te,n,a,Oe,d]),B=f.useCallback(()=>Ie??v?.nodesRef.current.find(e=>e.id===q)?.context?.dataRef?.current.orientation,[q,v,Ie]),N=ae(e=>{if(S.current=!1,h.current=!0,e.which===229||!$.current&&e.currentTarget===D.current)return;if(w&&rr(e.key,m,O,K)){Y(e.key,B())||T(e),s.setOpen(!1,Q(le,e.nativeEvent)),we(x)&&(d?v?.events.emit("virtualfocus",x):x.focus());return}const c=t.current,r=fe(n,R),i=ve(n,R);if(oe||(e.key==="Home"&&(T(e),t.current=r,a(e)),e.key==="End"&&(T(e),t.current=i,a(e))),K>1){const l=Fe||Array.from({length:n.current.length},()=>({width:1,height:1})),I=qe(l,K,ke),z=I.findIndex(y=>y!=null&&!de(n,y,R)),ue=I.reduce((y,G,Ne)=>G!=null&&!de(n,G,R)?Ne:y,-1),J=I[He({current:I.map(y=>y!=null?n.current[y]:null)},{event:e,orientation:m,loopFocus:re,rtl:O,cols:K,disabledIndices:Be([...(typeof R!="function"?R:null)||n.current.map((y,G)=>de(n,G,R)?G:void 0),void 0],I),minIndex:z,maxIndex:ue,prevIndex:$e(t.current>i?r:t.current,l,I,K,e.key===Z?"bl":e.key===(O?W:_)?"tr":"tl"),stopEvent:!0})];if(J!=null&&(t.current=J,a(e)),m==="both")return}if(Y(e.key,m)){if(T(e),u&&!d&&Pe(e.currentTarget.ownerDocument)===e.currentTarget){t.current=me(e.key,m,O)?r:i,a(e);return}me(e.key,m,O)?re?c>=i?ge&&c!==n.current.length?t.current=-1:(h.current=!1,t.current=r):t.current=X(n,{startingIndex:c,disabledIndices:R}):t.current=Math.min(i,X(n,{startingIndex:c,disabledIndices:R})):re?c<=r?ge&&c!==-1?t.current=n.current.length:(h.current=!1,t.current=i):t.current=X(n,{startingIndex:c,decrement:!0,disabledIndices:R}):t.current=Math.max(r,X(n,{startingIndex:c,decrement:!0,disabledIndices:R})),Me(n,t.current)&&(t.current=-1),a(e)}}),U=f.useMemo(()=>d&&u&&Ee&&{"aria-activedescendant":`${Re}-${b}`},[d,u,Ee,Re,b]),ye=f.useMemo(()=>({"aria-orientation":m==="both"?void 0:m,...oe?{}:U,onKeyDown(e){if(e.key==="Tab"&&e.shiftKey&&u&&!d){const c=Qe(e.nativeEvent);if(c&&!Ce(D.current,c))return;T(e),s.setOpen(!1,Q(We,e.nativeEvent)),we(x)&&x.focus();return}N(e)},onPointerMove(){S.current=!0}}),[U,N,D,m,oe,s,u,d,x]),j=f.useMemo(()=>{function e(r){M==="auto"&&Xe(r.nativeEvent)&&(P.current=!d)}function c(r){P.current=M,M==="auto"&&Ye(r.nativeEvent)&&(P.current=!0)}return{onKeyDown(r){const i=s.select("open");S.current=!1;const l=r.key.startsWith("Arrow"),I=er(r.key,B(),O),z=Y(r.key,m),ue=(w?I:z)||r.key==="Enter"||r.key.trim()==="";if(d&&i)return N(r);if(!(!i&&!ne&&l)){if(ue){const J=Y(r.key,B());C.current=w&&J?null:r.key}if(w){I&&(T(r),i?(t.current=fe(n,ce.current),a(r)):s.setOpen(!0,Q(le,r.nativeEvent,r.currentTarget)));return}z&&(V.current!=null&&(t.current=V.current),T(r),!i&&ne?s.setOpen(!0,Q(le,r.nativeEvent,r.currentTarget)):N(r),i&&a(r))}},onFocus(r){s.select("open")&&!d&&(t.current=-1,a(r))},onPointerDown:c,onPointerEnter:c,onMouseDown:e,onClick:e}},[N,ce,M,n,w,a,s,ne,m,B,O,V,d]),be=f.useMemo(()=>({...U,...j}),[U,j]);return f.useMemo(()=>E?{reference:be,floating:ye,item:ie,trigger:j}:{},[E,be,ye,j,ie])}export{pr as u};
